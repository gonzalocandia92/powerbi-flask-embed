<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Reporte embebido - {{ config_name }}</title>
    <script src="https://cdn.jsdelivr.net/npm/powerbi-client@2.23.1/dist/powerbi.min.js"></script>
    <style>#reportContainer{height:80vh;width:100%;border:1px solid #ccc;}</style>
</head>
<body>
    <h1>Reporte embebido - {{ config_name }}</h1>
    <div id="reportContainer"></div>
    <div id="errorDisplay" style="color: red; margin-top: 1em;"></div>

    <script>
        const models = window['powerbi-client']?.models || window.powerbi?.models;
        const config = {
            type: 'report',
            tokenType: models.TokenType.Aad,
            accessToken: "{{ embed_token }}",
            embedUrl: "{{ embed_url }}",
            id: "{{ report_id }}",
            settings: {
                panes: { filters: { visible: true }, pageNavigation: { visible: true }},
                bars: { statusBar: { visible: true }},
                hideErrors: false
            }
        };

        const container = document.getElementById("reportContainer");
        try {
            const report = powerbi.embed(container, config);
            report.on("error", function (event) {
                document.getElementById("errorDisplay").innerText = "Error al renderizar Power BI: " + (event.detail?.message || JSON.stringify(event.detail));
            });
        } catch (e) {
            document.getElementById("errorDisplay").innerText = "Excepci√≥n en el embed: " + e.message;
        }
    </script>
</body>
</html>
