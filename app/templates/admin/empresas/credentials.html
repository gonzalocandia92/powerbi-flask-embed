{% extends "layout.html" %}

{% block title %}{{ title }} - PowerBI Embed Admin{% endblock %}

{% block body %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-shield-check me-2"></i>{{ title }}</h2>
  </div>

  <div class="row justify-content-center">
    <div class="col-md-10">
      <div class="alert alert-warning" role="alert">
        <h5 class="alert-heading">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          ¡IMPORTANTE! Guarde estas credenciales
        </h5>
        <p class="mb-0">
          Este es el <strong>único momento</strong> en el que podrá ver el <strong>Client Secret</strong>. 
          Una vez que salga de esta página, no podrá recuperarlo. 
          Si lo pierde, deberá regenerar las credenciales.
        </p>
      </div>

      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-key me-2"></i>Credenciales de la Empresa: {{ empresa.nombre }}</h5>
        </div>
        <div class="card-body">
          <div class="mb-4">
            <label class="form-label fw-bold">Client ID</label>
            <div class="input-group">
              <input type="text" class="form-control font-monospace" id="clientId" value="{{ client_id }}" readonly>
              <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('clientId')">
                <i class="bi bi-clipboard"></i> Copiar
              </button>
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label fw-bold">Client Secret</label>
            <div class="input-group">
              <input type="text" class="form-control font-monospace" id="clientSecret" value="{{ client_secret }}" readonly>
              <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('clientSecret')">
                <i class="bi bi-clipboard"></i> Copiar
              </button>
            </div>
          </div>

          <div class="alert alert-info">
            <h6 class="alert-heading">
              <i class="bi bi-info-circle me-2"></i>Cómo usar estas credenciales
            </h6>
            <p>Use estas credenciales para autenticarse en el endpoint <code>/private/login</code>:</p>
            <pre class="mb-0"><code>POST /private/login
Content-Type: application/json

{
  "client_id": "{{ client_id }}",
  "client_secret": "{{ client_secret }}"
}</code></pre>
          </div>

          <div class="d-grid gap-2">
            <button class="btn btn-success btn-lg" onclick="copyBothToClipboard()">
              <i class="bi bi-clipboard-check me-2"></i>Copiar Ambas Credenciales
            </button>
            <a href="{{ url_for('empresas.list') if not from_futura else url_for('futuras_empresas.list') }}" class="btn btn-primary">
              <i class="bi bi-check-circle me-2"></i>He guardado las credenciales, continuar
            </a>
          </div>
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-header">
          <h6 class="mb-0"><i class="bi bi-journal-code me-2"></i>Ejemplo de Uso</h6>
        </div>
        <div class="card-body">
          <p class="mb-2"><strong>1. Obtener Token de Acceso:</strong></p>
          <pre class="bg-light p-3 rounded"><code>curl -X POST {{ request.url_root }}private/login \
  -H "Content-Type: application/json" \
  -d '{
    "client_id": "{{ client_id }}",
    "client_secret": "{{ client_secret }}"
  }'</code></pre>

          <p class="mb-2 mt-3"><strong>2. Consultar Configuración de Reporte:</strong></p>
          <pre class="bg-light p-3 rounded"><code>curl -X POST {{ request.url_root }}private/report-config \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -d '{
    "config_id": 1
  }'</code></pre>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function copyToClipboard(elementId) {
  var element = document.getElementById(elementId);
  element.select();
  element.setSelectionRange(0, 99999); // For mobile devices
  
  navigator.clipboard.writeText(element.value).then(function() {
    var label = elementId === 'clientId' ? 'Client ID' : 'Client Secret';
    alert(label + ' copiado al portapapeles');
  }, function(err) {
    console.error('Error al copiar: ', err);
  });
}

function copyBothToClipboard() {
  var text = "Client ID: {{ client_id }}\nClient Secret: {{ client_secret }}";
  navigator.clipboard.writeText(text).then(function() {
    alert('Credenciales copiadas al portapapeles');
  }, function(err) {
    console.error('Error al copiar: ', err);
  });
}
</script>
{% endblock %}
