{% extends "layout.html" %}

{% block title %}API Documentation - PowerBI Embed Admin{% endblock %}

{% block body %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-file-earmark-code me-2"></i>{{ title }}</h2>
  </div>

  <div class="row">
    <div class="col-md-3">
      <div class="card shadow-sm sticky-top" style="top: 20px;">
        <div class="card-header">
          <h6 class="mb-0">Endpoints</h6>
        </div>
        <div class="list-group list-group-flush">
          <a href="#login" class="list-group-item list-group-item-action">
            <span class="badge bg-success me-2">POST</span>/private/login
          </a>
          <a href="#reports" class="list-group-item list-group-item-action">
            <span class="badge bg-primary me-2">GET</span>/private/reports
          </a>
          <a href="#report-config" class="list-group-item list-group-item-action">
            <span class="badge bg-primary me-2">GET</span>/private/report-config
          </a>
        </div>
      </div>
    </div>

    <div class="col-md-9">
      <!-- Login Endpoint -->
      <div class="card shadow-sm mb-4" id="login">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">
            <span class="badge bg-light text-success me-2">POST</span>
            /private/login
          </h5>
        </div>
        <div class="card-body">
          <h6>Descripción</h6>
          <p>Autentica una empresa y devuelve un token JWT para acceder a los reportes.</p>

          <h6>Request Body</h6>
          <pre class="bg-light p-3 rounded"><code>{
  "client_id": "string",
  "client_secret": "string"
}</code></pre>

          <h6>Respuestas</h6>
          <div class="accordion" id="loginResponses">
            <div class="accordion-item">
              <h2 class="accordion-header" id="login200">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLogin200">
                  <span class="badge bg-success me-2">200</span> OK
                </button>
              </h2>
              <div id="collapseLogin200" class="accordion-collapse collapse show" data-bs-parent="#loginResponses">
                <div class="accordion-body">
                  <pre class="bg-light p-3 rounded"><code>{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "Bearer",
  "expires_in": 3600
}</code></pre>
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLogin400">
                  <span class="badge bg-warning me-2">400</span> Bad Request
                </button>
              </h2>
              <div id="collapseLogin400" class="accordion-collapse collapse" data-bs-parent="#loginResponses">
                <div class="accordion-body">
                  Solicitud inválida. Verifica que client_id y client_secret estén presentes.
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLogin401">
                  <span class="badge bg-danger me-2">401</span> Unauthorized
                </button>
              </h2>
              <div id="collapseLogin401" class="accordion-collapse collapse" data-bs-parent="#loginResponses">
                <div class="accordion-body">
                  Credenciales inválidas.
                </div>
              </div>
            </div>
          </div>

          <h6 class="mt-3">Ejemplo cURL</h6>
          <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST {{ request.url_root }}private/login \
  -H "Content-Type: application/json" \
  -d '{
    "client_id": "your-client-id",
    "client_secret": "your-client-secret"
  }'</code></pre>
        </div>
      </div>

      <!-- Reports Endpoint -->
      <div class="card shadow-sm mb-4" id="reports">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <span class="badge bg-light text-primary me-2">GET</span>
            /private/reports
          </h5>
        </div>
        <div class="card-body">
          <h6>Descripción</h6>
          <p>Obtiene la lista de reportes asociados a la empresa autenticada.</p>

          <h6>Headers</h6>
          <pre class="bg-light p-3 rounded"><code>Authorization: Bearer {access_token}</code></pre>

          <h6>Respuestas</h6>
          <div class="accordion" id="reportsResponses">
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseReports200">
                  <span class="badge bg-success me-2">200</span> OK
                </button>
              </h2>
              <div id="collapseReports200" class="accordion-collapse collapse show" data-bs-parent="#reportsResponses">
                <div class="accordion-body">
                  <pre class="bg-light p-3 rounded"><code>{
  "empresa_id": 1,
  "empresa_nombre": "Empresa Demo SA",
  "reports": [
    {
      "config_id": 1,
      "config_name": "Reporte Ventas",
      "report_id": "abc-123",
      "report_name": "Dashboard Ventas"
    }
  ]
}</code></pre>
                </div>
              </div>
            </div>
          </div>

          <h6 class="mt-3">Ejemplo cURL</h6>
          <pre class="bg-dark text-light p-3 rounded"><code>curl -X GET {{ request.url_root }}private/reports \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"</code></pre>
        </div>
      </div>

      <!-- Report Config Endpoint -->
      <div class="card shadow-sm mb-4" id="report-config">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <span class="badge bg-light text-primary me-2">GET</span>
            /private/report-config
          </h5>
        </div>
        <div class="card-body">
          <h6>Descripción</h6>
          <p>Obtiene la configuración necesaria para embeber un reporte específico.</p>

          <h6>Headers</h6>
          <pre class="bg-light p-3 rounded"><code>Authorization: Bearer {access_token}</code></pre>

          <h6>Query Parameters</h6>
          <ul>
            <li><code>config_id</code> (integer, required): ID de la configuración del reporte</li>
          </ul>

          <h6>Respuestas</h6>
          <div class="accordion" id="configResponses">
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseConfig200">
                  <span class="badge bg-success me-2">200</span> OK
                </button>
              </h2>
              <div id="collapseConfig200" class="accordion-collapse collapse show" data-bs-parent="#configResponses">
                <div class="accordion-body">
                  <pre class="bg-light p-3 rounded"><code>{
  "embedUrl": "https://app.powerbi.com/reportEmbed?reportId=...",
  "reportId": "abc-123",
  "accessToken": "eyJ0eXAi...",
  "workspaceId": "xyz-789"
}</code></pre>
                </div>
              </div>
            </div>
          </div>

          <h6 class="mt-3">Ejemplo cURL</h6>
          <pre class="bg-dark text-light p-3 rounded"><code>curl -X GET "{{ request.url_root }}private/report-config?config_id=1" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"</code></pre>
        </div>
      </div>

      <!-- OpenAPI Spec -->
      <div class="card shadow-sm">
        <div class="card-header">
          <h5 class="mb-0"><i class="bi bi-file-earmark-code me-2"></i>OpenAPI Specification</h5>
        </div>
        <div class="card-body">
          <p>Para obtener la especificación completa de OpenAPI en formato JSON:</p>
          <a href="{{ url_for('api_docs.openapi_spec') }}" class="btn btn-primary" target="_blank">
            <i class="bi bi-download me-2"></i>Descargar openapi.json
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
